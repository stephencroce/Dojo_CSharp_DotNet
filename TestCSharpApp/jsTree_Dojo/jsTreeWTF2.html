<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>jsTree</title>
    
    <link href="lib/jsTree/dist/themes/default/style.min.css" rel="stylesheet" />
    
    <script src="lib/jsTree/dist/libs/jquery.min.js"></script>    
    <script src="lib/jsTree/dist/jstree.min.js"></script>

</head>
<body>
    <h3>jsTree DOJO</h3>
    <div class="row">
        <div id="sourceRuns" class="demo" style="margin-top:1em; min-height:200px; border:dashed green 1px;"></div>
        <div id="targetRuns" class="demo" style="margin-top:1em; min-height:200px; border:dashed blue 1px;"></div>
        <div id="jstree_testData" class="demo" style="margin-top:1em; min-height:200px; border:dashed orange 1px;"></div>
        <div id="jstree_testData2" class="demo" style="margin-top:1em; min-height:200px; border:dashed red 1px;"></div>
        <script>

            var testData = ["Child 1", { "id": "demo_child_1", "text": "Child 2", "children": [{ "id": "demo_child_2", "text": "One more", "type": "file" }] }];
            var sources = [{ "text": "6-050819", "id": -1, "fullPath": null, "type": "rs", "children": [{ "id": "rn56214", "text": "6-050819-1", "type": "rn", "keywords": "HIL: RD270 100Å | HTL: RD270 250Å", "fullPath": null, "children": [{ "id": "c56214-0", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": "c", "keywords": null, "fullPath": null, "children": [] }], "a_attr": { "title": "HIL: RD270 100Å | HTL: RD270 250Å" } }] }];
            var targets = [{ "text": "Accl Factor", "id": "r4", "fullPath": null, "type": null, "children": [] }, { "text": "SDC - Blue", "id": "r312", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-Blue", "id": "r97", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-RG", "id": "r96", "fullPath": null, "type": null, "children": [] }, { "text": "White", "id": "r14", "fullPath": null, "type": null, "children": [{ "id": "s6939", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }]
            var targetsMessedUp1 = [{ "text": "Accl Factor", "id": "r4", "fullPath": null, "type": null, "children": [{ "id": "s6940", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }, { "id": "c101", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }, { "text": "SDC - Blue", "id": "r312", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-Blue", "id": "r97", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-RG", "id": "r96", "fullPath": null, "type": null, "children": [] }, { "text": "White", "id": "r14", "fullPath": null, "type": null, "children": [{ "id": "s6939", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }, { "id": "s6940", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c101", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }, { "id": "c102", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }];
            var targetsMessedUp2 = [{ "text": "Accl Factor", "id": "r4", "fullPath": null, "type": null, "children": [{ "id": "s6940", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }, { "text": "SDC - Blue", "id": "r312", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-Blue", "id": "r97", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-RG", "id": "r96", "fullPath": null, "type": null, "children": [] }, { "text": "White", "id": "r14", "fullPath": null, "type": null, "children": [{ "id": "s6939", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }, { "id": "s6940", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c101", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }];
            var targetsMessedUp3 = [{ "text": "Accl Factor", "id": "r4_0b3ddebf-6bdc-4f04-a34e-6009adaa849e", "fullPath": null, "type": null, "children": [{ "id": "s69420cdd8142-d759-4729-ad11-d7b773ac3731", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100f55ec43c-8f13-417a-a5b6-da01729fcc10", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }, { "id": "c1017911ed51-48b3-4c41-91f5-11fae3d3fa0c", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }, { "text": "SDC - Blue", "id": "r31244325307-fb33-4b0e-9a28-a2d6279fdb5a", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-Blue", "id": "r97abd236dd-34af-4554-82b8-804f96b23bf0", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-RG", "id": "r969187ec21-97fb-4e3f-895a-409fae364ac2", "fullPath": null, "type": null, "children": [] }, { "text": "White", "id": "r14938a4f28-3225-4eef-aaea-0a347a84fc83", "fullPath": null, "type": null, "children": [{ "id": "s6939ea7da89c-a568-4c98-b112-c08ad38f4e5d", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c10012b8d249-38a5-4fdc-bdbb-2afe4075cf33", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }];
            var targetsMessedUp4 = [{ "text": "Accl Factor", "id": "r4", "fullPath": null, "type": null, "children": [{ "id": "s6942", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }, { "id": "c101", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }, { "text": "SDC - Blue", "id": "r312", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-Blue", "id": "r97", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-RG", "id": "r96", "fullPath": null, "type": null, "children": [] }, { "text": "White", "id": "r14", "fullPath": null, "type": null, "children": [{ "id": "s6939", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }];
            var targetsMessedUp5 = [{ "text": "Accl Factor", "id": "r4_0500bdbe-3e6e-46a4-b764-95a2396bfbc3", "fullPath": null, "type": null, "children": [{ "id": "s6966_c1d5009d-46fd-41b9-a655-13bcf83f9728", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100_82611cba-75c3-44eb-a4bd-6c3272a770b3", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }, { "id": "c101_b042a26a-a792-48c8-b1e5-2d23f2c166e1", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }, { "text": "UDC-Blue", "id": "r97_3ad4bbbe-bc3d-46e4-b8b6-db5dacf7a409", "fullPath": null, "type": null, "children": [] }, { "text": "White", "id": "r14_8fea9fcc-41c2-42fd-b37d-6845887bfa66", "fullPath": null, "type": null, "children": [{ "id": "s6966_ddec6000-0d0b-4272-ab79-864a7e232199", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100_c2b12df8-b9af-4d93-b056-37473c60f268", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }, { "id": "c101_1d0f94d2-7a05-4835-81f2-649e6d2f870f", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }];
            var targetsMessedUpFixed = [{ "text": "Accl Factor", "id": "r4", "fullPath": null, "type": null, "children": [{ "id": "s6940", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }, { "text": "SDC - Blue", "id": "r312", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-Blue", "id": "r97", "fullPath": null, "type": null, "children": [] }, { "text": "UDC-RG", "id": "r96", "fullPath": null, "type": null, "children": [] }, { "text": "White", "id": "r14", "fullPath": null, "type": null, "children": [{ "id": "s6939", "text": "6-050819-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c100XXX", "text": "6-050819-1:1,2,3,4,5,6,7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }, { "id": "s6940XXX", "text": "A-032019-1", "type": null, "keywords": null, "fullPath": null, "children": [{ "id": "c101", "text": "A-032019-1:7,8,9", "type": null, "keywords": null, "fullPath": null, "children": [], "li_attr": { "class": "target-run-node" } }], "li_attr": { "class": "target-run-node" } }] }];
            var paintCounter = 0;
                                 

            //load source
            $('#sourceRuns')
                .jstree({
                    "core": {
                        'data': sources,
                    },
                    "plugins": ["dnd"],
                    "dnd": {
                        //check_while_dragging: true //a boolean indicating if checks should constantly be made while the user is dragging the node (as opposed to checking only on drop), default is true
                    },
                });


            //load target
            $("#targetRuns")
                .jstree({
                    "core": {
                        "data": targetsMessedUpFixed,
                        'check_callback': function (operation, node, node_parent, node_position, more) {
                            //console.log('check_callback: ' + operation);
                            if (more) {
                                //console.log("target - node_position = " + node_position)
                                //console.log('nodeparent = ' + JSON.stringify(node_parent));
                                //console.log('more.ref = ' + JSON.stringify(more.ref));
                                //if (node_parent.id === "#")             //disallow dropping to root level
                                // return false;

                                //if (more.is_multi) {
                                //    dragNode = node;
                                //    more.origin.settings.dnd.always_copy = true;
                                //} else {
                                //    more.origin.settings.dnd.always_copy = false;
                                //}
                            } else {
                                console.log('more not defined');
                            }

                            $("#sourceRuns").jstree().deselect_all(true);

                            return true;

                        },
                    },
                    "dnd": {
                        check_while_dragging: true,
                        always_copy: true
                    },
                    "types": {
                        "#": {
                            "valid_children": "none"
                        },
                        "r": {
                            "valid_children": ["rs", "rn", "c"]
                        },
                        "rs": {
                            "valid_children": "none"
                        },
                        "rn": {
                            "valid_children": "none"
                        }
                        ,
                        "c": {
                            "valid_children": "none"
                        }
                    },

                    "plugins": ["dnd", "sort", "types", "unique"],

                    "unique": {
                        "duplicate": function (name, counter) {
                            return false;
                        }

                    }
                });


            $("#targetRuns").on('changed.jstree', function (e, data) {
                console.log('#targetRuns :: changed.jstree');

            });
            $("#sourceRuns").on('move_node.jstree', function (e, data) {
                console.log('#sourceRuns :: move_node.jstree');
                console.log('source is multi: ' + data.is_multi);
            });
            $("#targetRuns").on('move_node.jstree', function (e, data) {
                console.log('#targetRuns :: move_node.jstree');
                console.log('target is multi: ' + data.is_multi);
            });
            $("#targetRuns").on('redraw.jstree', function (e, data) {
                //console.log(paintCounter);
                //if (paintCounter > 0) {
                    console.log('#targetRuns :: redraw.jstree');
                //}
                //paintCounter++;
            });


            //load test Data
            $('#jstree_testData')
                .jstree({
                    "core": {
                        'data': testData
                    }
                });

            var mimic = [{ "id": "ajson1", "parent": "#", "text": "Simple root node" }, { "id": "ajson1a", "parent": "ajson1", "text": "Child 1" }, { "id": "ajson2", "parent": "#", "text": "Root node 2" }, { "id": "ajson3", "parent": "ajson2", "text": "Child 1" }, { "id": "ajson4", "parent": "ajson2", "text": "Child 2" }];
            var mimic2 = [{ "id": "ajson1", "parent": "#", "text": "Accl Factor" }, { "id": "ajson1a", "parent": "ajson1", "text": "A-032019-1" }, { "id": "ajson1aa", "parent": "ajson1a", "text": "A-032019-1:7,8,9" }, { "id": "ajson2", "parent": "#", "text": "White" }, { "id": "ajson3", "parent": "ajson2", "text": "A-032019-1" }, { "id": "ajson4", "parent": "ajson3", "text": "A-032019-1:7,8,9" }];
            //Using the alternative JSON format
            $('#jstree_testData2').jstree({
                'core': {
                    'data': mimic2
                }
            });

        </script>
    </div>
</body>
</html>
